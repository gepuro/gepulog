language: bash

env:
    global:
    - GIT_AUTHOR_EMAIL=gepuro@gmail.com
    - GIT_AUTHOR_NAME~gepuro
    - HUGO_VERSION=0.32.1
    - GIT_URL=git@github.com:gepuro/gepulog.git

before_install:
  - openssl aes-256-cbc -K $encrypted_6d24ef37b060_key -iv $encrypted_6d24ef37b060_iv -in gepulog.enc -out deploy_key -d
  - chmod 600 deploy_key
  - eval `ssh-agent -s`
  - ssh-add deploy_key

install:
  - wget https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.tar.gz
  - tar zxvf hugo_${HUGO_VERSION}_Linux-64bit.tar.gz

before_deploy:
  - git remote set-url origin ${GIT_URL}
  - ls -la
  - ./hugo -t hugo-theme-one
  - ls -la docs/
  - ls -la docs/posts/

deploy:
  skip_cleanup: true
  provider: script
  script: bash deploy.sh
  on:
    branch: master
